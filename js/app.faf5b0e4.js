(function(){"use strict";var e={3525:function(e,t,a){var n=a(693),o=a(9522),s=(a(5680),a(2003)),i=a(6739);const r={role:"status"},l=(0,s.Lk)("svg",{"aria-hidden":"true",class:"inline w-6 h-6 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,s.Lk)("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),(0,s.Lk)("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})],-1),c=(0,s.Lk)("span",{class:"sr-only"},"Loading...",-1),u=[l,c];function d(e,t){return(0,s.uX)(),(0,s.CE)("div",r,u)}var v=a(3489);const h={},p=(0,v.A)(h,[["render",d]]);var f=p;const g=(0,i.KR)({toastIsShown:!1,showToast:e=>{g.value.toastIsShown=!1,g.value.message=e,g.value.toastIsShown=!0,setTimeout((()=>{g.value.toastIsShown=!1}),15500)},message:"Something went wrong"}),L=(0,i.KR)(!1);function w(){return{isLoading:L,errorToast:g,showLoading:()=>L.value=!0,hideLoading:()=>L.value=!1}}const m={key:0,class:"w-full h-full z-50 fixed top-0 left-0 backdrop-blur-sm"},y={class:"flex w-full h-full fixed z-[51] items-center justify-center"},x={class:"bg-white shadow-2xl p-4 rounded-md border"};var b=(0,s.pM)({__name:"global-loader",setup(e){const{isLoading:t}=w();return(e,a)=>(0,i.R1)(t)?((0,s.uX)(),(0,s.CE)("div",m,[(0,s.Lk)("div",y,[(0,s.Lk)("div",x,[(0,s.bF)(f)])])])):(0,s.Q3)("",!0)}});const k=b;var M=k,H=a(3582),C=a(3247);const R={key:0,class:"fixed top-1 z-[100] flex w-full justify-center",initial:{y:-100},enter:{y:0},delay:20},V={id:"toast-warning",class:"flex items-center w-full max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800",role:"alert"},T=(0,s.Lk)("div",{class:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-orange-500 bg-orange-100 rounded-lg dark:bg-orange-700 dark:text-orange-200"},[(0,s.Lk)("svg",{class:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},[(0,s.Lk)("path",{d:"M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM10 15a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm1-4a1 1 0 0 1-2 0V6a1 1 0 0 1 2 0v5Z"})]),(0,s.Lk)("span",{class:"sr-only"},"Warning icon")],-1),Z={class:"ms-3 text-sm font-normal"},_=(0,s.Lk)("span",{class:"sr-only"},"Close",-1),j=(0,s.Lk)("svg",{class:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14"},[(0,s.Lk)("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})],-1),S=[_,j];var E=(0,s.pM)({__name:"error-toast",setup(e){const{errorToast:t}=w(),a=(0,C.rd)(),n=async()=>{await a.push("/"),await a.push("/avatar"),t.value.toastIsShown=!1};return(e,a)=>{const o=(0,s.gN)("motion");return(0,i.R1)(t).toastIsShown?(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",R,[(0,s.Lk)("div",V,[T,(0,s.Lk)("div",Z,(0,H.v_)((0,i.R1)(t).message),1),(0,s.Lk)("a",{onClick:n,class:"inline-flex px-2.5 py-1.5 text-xs font-medium text-center text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-blue-800"},"Retry"),(0,s.Lk)("button",{onClick:a[0]||(a[0]=e=>(0,i.R1)(t).toastIsShown=!1),type:"button",class:"ms-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700","data-dismiss-target":"#toast-warning","aria-label":"Close"},S)])])),[[o]]):(0,s.Q3)("",!0)}}});const K=E;var O=K;const I={class:"home min-h-[100vh] flex flex-col pt-[20vh] items-center bg-blue-900 py-4 px-4"},P=(0,s.Lk)("div",{class:"absolute inset-x-0 m-auto h-80 max-w-lg bg-gradient-to-tr from-indigo-400 via-teal-900 to-[#C084FC] blur-[118px]"},null,-1),N={class:"z-[2] flex space-x-4"},A=(0,s.Fv)('<svg class="max-w-[96px]" width="513" height="343" viewBox="0 0 513 343" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_301_131)"><path d="M0 0.957031H513V342.957H0V0.957031Z" fill="white"></path><path d="M0 0.957031H513V27.257H0V0.957031ZM0 53.557H513V79.857H0V53.557ZM0 106.157H513V132.457H0V106.157ZM0 158.757H513V185.057H0V158.757ZM0 211.457H513V237.757H0V211.457ZM0 264.057H513V290.357H0V264.057ZM0 316.657H513V342.957H0V316.657Z" fill="#D80027"></path><path d="M0 0.957031H256.5V185.057H0V0.957031Z" fill="#2E52B2"></path><path d="M47.8002 139.857L43.8002 127.057L39.4002 139.857H26.2002L36.9002 147.557L32.9002 160.357L43.8002 152.457L54.4002 160.357L50.3002 147.557L61.2002 139.857H47.8002ZM104.1 139.857L100 127.057L95.8002 139.857H82.6002L93.3002 147.557L89.3002 160.357L100 152.457L110.8 160.357L106.8 147.557L117.5 139.857H104.1ZM160.6 139.857L156.3 127.057L152.3 139.857H138.8L149.8 147.557L145.6 160.357L156.3 152.457L167.3 160.357L163.1 147.557L173.8 139.857H160.6ZM216.8 139.857L212.8 127.057L208.6 139.857H195.3L206.1 147.557L202.1 160.357L212.8 152.457L223.6 160.357L219.3 147.557L230.3 139.857H216.8ZM100 76.2572L95.8002 89.0572H82.6002L93.3002 96.9572L89.3002 109.557L100 101.757L110.8 109.557L106.8 96.9572L117.5 89.0572H104.1L100 76.2572ZM43.8002 76.2572L39.4002 89.0572H26.2002L36.9002 96.9572L32.9002 109.557L43.8002 101.757L54.4002 109.557L50.3002 96.9572L61.2002 89.0572H47.8002L43.8002 76.2572ZM156.3 76.2572L152.3 89.0572H138.8L149.8 96.9572L145.6 109.557L156.3 101.757L167.3 109.557L163.1 96.9572L173.8 89.0572H160.6L156.3 76.2572ZM212.8 76.2572L208.6 89.0572H195.3L206.1 96.9572L202.1 109.557L212.8 101.757L223.6 109.557L219.3 96.9572L230.3 89.0572H216.8L212.8 76.2572ZM43.8002 25.6572L39.4002 38.2572H26.2002L36.9002 46.1572L32.9002 58.8572L43.8002 50.9572L54.4002 58.8572L50.3002 46.1572L61.2002 38.2572H47.8002L43.8002 25.6572ZM100 25.6572L95.8002 38.2572H82.6002L93.3002 46.1572L89.3002 58.8572L100 50.9572L110.8 58.8572L106.8 46.1572L117.5 38.2572H104.1L100 25.6572ZM156.3 25.6572L152.3 38.2572H138.8L149.8 46.1572L145.6 58.8572L156.3 50.9572L167.3 58.8572L163.1 46.1572L173.8 38.2572H160.6L156.3 25.6572ZM212.8 25.6572L208.6 38.2572H195.3L206.1 46.1572L202.1 58.8572L212.8 50.9572L223.6 58.8572L219.3 46.1572L230.3 38.2572H216.8L212.8 25.6572Z" fill="white"></path></g><defs><clipPath id="clip0_301_131"><rect width="513" height="342" fill="white" transform="translate(0 0.957031)"></rect></clipPath></defs></svg>',1),B=[A],X=(0,s.Fv)('<svg class="max-w-[96px]" width="513" height="342" viewBox="0 0 513 342" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_301_429)"><path d="M0 -0.00292969V341.996H513V-0.00292969H0Z" fill="white"></path><path d="M0 0H513V342.004H0V0Z" fill="#0052B4"></path><path d="M0 0H513V113.997H0V0Z" fill="white"></path><path d="M0 227.995H513V341.992H0V227.995Z" fill="#D80027"></path></g><defs><clipPath id="clip0_301_429"><rect width="513" height="342" fill="white"></rect></clipPath></defs></svg>',1),F=[X];var z=(0,s.pM)({__name:"HomeView",setup(e){const t=(0,C.rd)(),a=e=>{localStorage.setItem("lang",e),t.push("/avatar")};return(e,t)=>((0,s.uX)(),(0,s.CE)("div",I,[P,(0,s.Lk)("div",N,[(0,s.Lk)("div",{onClick:t[0]||(t[0]=()=>a("en")),class:"active:scale-95 transition-transform"},B),(0,s.Lk)("div",{onClick:t[1]||(t[1]=()=>a("ru")),class:"active:scale-95 transition-transform"},F)])]))}});const W=z;var Y=W;function D(e,t){return(0,s.uX)(),(0,s.CE)("button",{onContextmenu:t[0]||(t[0]=(0,o.D$)((()=>{}),["stop","prevent"])),class:"text-white transition-all select-none bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 shadow-lg shadow-blue-500/50 dark:shadow-lg dark:shadow-blue-800/80 font-medium rounded-lg text-[20px] px-5 py-2.5 text-center me-2 mb-2"},[(0,s.RG)(e.$slots,"default")],32)}const q={},$=(0,v.A)(q,[["render",D]]);var J=$;const G={class:"max-w-[24px] max-h-[24px]",width:"513",height:"343",viewBox:"0 0 513 343",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Q=(0,s.Fv)('<g clip-path="url(#clip0_301_131)"><path d="M0 0.957031H513V342.957H0V0.957031Z" fill="white"></path><path d="M0 0.957031H513V27.257H0V0.957031ZM0 53.557H513V79.857H0V53.557ZM0 106.157H513V132.457H0V106.157ZM0 158.757H513V185.057H0V158.757ZM0 211.457H513V237.757H0V211.457ZM0 264.057H513V290.357H0V264.057ZM0 316.657H513V342.957H0V316.657Z" fill="#D80027"></path><path d="M0 0.957031H256.5V185.057H0V0.957031Z" fill="#2E52B2"></path><path d="M47.8002 139.857L43.8002 127.057L39.4002 139.857H26.2002L36.9002 147.557L32.9002 160.357L43.8002 152.457L54.4002 160.357L50.3002 147.557L61.2002 139.857H47.8002ZM104.1 139.857L100 127.057L95.8002 139.857H82.6002L93.3002 147.557L89.3002 160.357L100 152.457L110.8 160.357L106.8 147.557L117.5 139.857H104.1ZM160.6 139.857L156.3 127.057L152.3 139.857H138.8L149.8 147.557L145.6 160.357L156.3 152.457L167.3 160.357L163.1 147.557L173.8 139.857H160.6ZM216.8 139.857L212.8 127.057L208.6 139.857H195.3L206.1 147.557L202.1 160.357L212.8 152.457L223.6 160.357L219.3 147.557L230.3 139.857H216.8ZM100 76.2572L95.8002 89.0572H82.6002L93.3002 96.9572L89.3002 109.557L100 101.757L110.8 109.557L106.8 96.9572L117.5 89.0572H104.1L100 76.2572ZM43.8002 76.2572L39.4002 89.0572H26.2002L36.9002 96.9572L32.9002 109.557L43.8002 101.757L54.4002 109.557L50.3002 96.9572L61.2002 89.0572H47.8002L43.8002 76.2572ZM156.3 76.2572L152.3 89.0572H138.8L149.8 96.9572L145.6 109.557L156.3 101.757L167.3 109.557L163.1 96.9572L173.8 89.0572H160.6L156.3 76.2572ZM212.8 76.2572L208.6 89.0572H195.3L206.1 96.9572L202.1 109.557L212.8 101.757L223.6 109.557L219.3 96.9572L230.3 89.0572H216.8L212.8 76.2572ZM43.8002 25.6572L39.4002 38.2572H26.2002L36.9002 46.1572L32.9002 58.8572L43.8002 50.9572L54.4002 58.8572L50.3002 46.1572L61.2002 38.2572H47.8002L43.8002 25.6572ZM100 25.6572L95.8002 38.2572H82.6002L93.3002 46.1572L89.3002 58.8572L100 50.9572L110.8 58.8572L106.8 46.1572L117.5 38.2572H104.1L100 25.6572ZM156.3 25.6572L152.3 38.2572H138.8L149.8 46.1572L145.6 58.8572L156.3 50.9572L167.3 58.8572L163.1 46.1572L173.8 38.2572H160.6L156.3 25.6572ZM212.8 25.6572L208.6 38.2572H195.3L206.1 46.1572L202.1 58.8572L212.8 50.9572L223.6 58.8572L219.3 46.1572L230.3 38.2572H216.8L212.8 25.6572Z" fill="white"></path></g><defs><clipPath id="clip0_301_131"><rect width="513" height="342" fill="white" transform="translate(0 0.957031)"></rect></clipPath></defs>',2),U=[Q];function ee(e,t){return(0,s.uX)(),(0,s.CE)("svg",G,U)}const te={},ae=(0,v.A)(te,[["render",ee]]);var ne=ae;const oe={class:"max-w-[24px] max-h-[24px]",width:"513",height:"342",viewBox:"0 0 513 342",fill:"none",xmlns:"http://www.w3.org/2000/svg"},se=(0,s.Fv)('<g clip-path="url(#clip0_301_429)"><path d="M0 -0.00292969V341.996H513V-0.00292969H0Z" fill="white"></path><path d="M0 0H513V342.004H0V0Z" fill="#0052B4"></path><path d="M0 0H513V113.997H0V0Z" fill="white"></path><path d="M0 227.995H513V341.992H0V227.995Z" fill="#D80027"></path></g><defs><clipPath id="clip0_301_429"><rect width="513" height="342" fill="white"></rect></clipPath></defs>',2),ie=[se];function re(e,t){return(0,s.uX)(),(0,s.CE)("svg",oe,ie)}const le={},ce=(0,v.A)(le,[["render",re]]);var ue=ce;const de={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ve=(0,s.Lk)("rect",{x:"8",y:"1",width:"8",height:"14",rx:"4",stroke:"currentColor","stroke-width":"1.8"},null,-1),he=(0,s.Lk)("path",{d:"M19.5 10.5V11C19.5 15.1421 16.1421 18.5 12 18.5V18.5M4.5 10.5V11C4.5 15.1421 7.85786 18.5 12 18.5V18.5M12 18.5V22M12 22H16M12 22H8",stroke:"currentColor","stroke-width":"1.8","stroke-linecap":"round"},null,-1),pe=[ve,he];function fe(e,t){return(0,s.uX)(),(0,s.CE)("svg",de,pe)}const ge={},Le=(0,v.A)(ge,[["render",fe]]);var we=Le;const me={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ye=(0,s.Lk)("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2",fill:"currentColor"},null,-1),xe=[ye];function be(e,t){return(0,s.uX)(),(0,s.CE)("svg",me,xe)}const ke={},Me=(0,v.A)(ke,[["render",be]]);var He=Me;const Ce="https://api.heygen.com";let Re="NzY3MzI5ZDUxYTNmNDM3OGFiYmM5OWI2ODk2NDU3MjYtMTcxMjI1MzYyNA==";const{errorToast:Ve,hideLoading:Te}=w(),Ze=(0,i.KR)(!0),_e=(0,i.KR)(!1),je=(0,i.KR)("stopped"),Se=(0,i.KR)(""),Ee=(0,i.KR)(!1),Ke=(0,i.KR)(!1),Oe=(0,i.KR)(!1),Ie=(0,i.KR)(),Pe=(0,i.KR)(),Ne=(0,i.KR)(),Ae=(e,t,a)=>{Re="ru"===a?"ZThlYjExYWYwMWY3NGYwNGI5OWZlOTZjYjg4NmNiOTQtMTcxMjc2NjEwMw==":"NzY3MzI5ZDUxYTNmNDM3OGFiYmM5OWI2ODk2NDU3MjYtMTcxMjI1MzYyNA==";const n=async()=>{Ke.value=!0,Ze.value=!0,await De(),await new Promise(((a,n)=>{setTimeout((async()=>{await Be(e,t),a(1)}),300)})),await new Promise(((e,t)=>{setTimeout((async()=>{await Xe(),e(1)}),300)})),Ke.value=!1,je.value="started"};return{isError:_e,isGenerating:Oe,state:je,errorMessage:Se,mediaCanPlay:Ee,isLoading:Ke,sessionInfo:Ie,peerConnection:Pe,renderCanvas:Qe,closeConnection:Ye,iceConnectionState:Ne,start:n,generateVoice:async e=>{Ie.value&&(Oe.value=!0,await Je(Ie.value?.session_id,e))}}},Be=async(e,t)=>{const a="Kayla-incasualsuit-20220818",n="71b0aa6499f6458e8b040818a017db1f";if(Ie.value=await Fe("low",a,n),Ie.value){const{sdp:a,ice_servers2:n}=Ie.value;Pe.value=new RTCPeerConnection({iceServers:n}),Pe.value.ontrack=a=>{console.log("Received the track"),"audio"!==a.track.kind&&"video"!==a.track.kind||e.value&&(e.value.srcObject=a.streams[0],e.value.paused&&e.value.play().then((e=>{})).catch((()=>{})),Ze.value&&(Ze.value=!1,setTimeout((()=>{Qe(t,e)}),500)))},Pe.value.ondatachannel=e=>{const t=e.channel;t.onmessage=e=>{setTimeout((()=>{Oe.value=!1}),400)}};const o=new RTCSessionDescription(a);await Pe.value.setRemoteDescription(o)}},Xe=async()=>{if(!Ie.value||!Pe.value)return;const e=await Pe.value.createAnswer();await Pe.value.setLocalDescription(e),Pe.value.onicecandidate=({candidate:e})=>{console.log("Received ICE candidate:",e),setTimeout((()=>{e&&Ie.value&&ze(Ie.value.session_id,e.toJSON())}),300)},Pe.value.oniceconnectionstatechange=e=>{Ne.value=Pe.value?.iceConnectionState},await We(Ie.value.session_id,e),console.log("Session Started Successfully")};async function Fe(e,t,a){try{const n=await fetch(`${Ce}/v1/streaming.new`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":Re},body:JSON.stringify({quality:e,avatar_name:t,voice:{voice_id:a}})});if(n.status>399)throw new Error("Error: Creating new session failed!");const o=await n.json();return console.log(o.data),o.data}catch(n){throw console.log(n,"err"),je.value="stopped",Ke.value=!1,Ve.value.showToast(n.message),new Error("Hello")}}async function ze(e,t){const a=await fetch(`${Ce}/v1/streaming.ice`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":Re},body:JSON.stringify({session_id:e,candidate:t})});if(500===a.status)throw console.error("Server error"),_e.value=!0,Se.value="Server Error. Please ask the staff if the service has been turned on",new Error("Server error");{const e=await a.json();return e}}async function We(e,t){const a=await fetch(`${Ce}/v1/streaming.start`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":Re},body:JSON.stringify({session_id:e,sdp:t})});if(500===a.status)throw console.error("Server error"),_e.value=!0,Se.value="Server Error. Please ask the staff if the service has been turned on",new Error("Server error");{const e=await a.json();return e.data}}async function Ye(){if(Ie.value&&Pe.value){Ge.value++,Ee.value=!1,console.log("closing connection...");try{Pe.value.close();const e=await $e(Ie.value.session_id);je.value="stopped",console.log("conneciton closed"),console.log(e)}catch(e){console.error("Failed to close the connection:",e)}}}const De=async()=>{const e=await qe(),t=e.data;t.sessions&&t.sessions.length>0&&t.sessions.forEach((async e=>{await $e(e.session_id)}))};async function qe(){const e={method:"GET",headers:{accept:"application/json","x-api-key":Re}},t=await fetch(`${Ce}/v1/streaming.list`,e).then((e=>e.json()));return t}async function $e(e){try{const t=await fetch(`${Ce}/v1/streaming.stop`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":Re},body:JSON.stringify({session_id:e})});if(t.status>399)throw new Error("Error: Stopping current session failed");const a=await t.json();return a.data}catch(t){console.log(t,"err"),je.value="stopped",Ke.value=!1,Ve.value.showToast(t.message)}}async function Je(e,t){const a=await fetch(`${Ce}/v1/streaming.task`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":Re},body:JSON.stringify({session_id:e,text:t})});if(500===a.status)throw console.error("Server error"),new Error("Server error");{const e=await a.json();return e.data}}let Ge=(0,i.KR)(0);const Qe=(e,t)=>{const a=Math.trunc(1e9*Math.random());Ge.value=a;const n=e.value.getContext("2d",{willReadFrequently:!0});function o(){if(a!==Ge.value)return;if(!t.value.videoHeight||!t.value.videoWidth)return void setTimeout((()=>{o()}),200);e.value.width=t.value.videoWidth,e.value.height=t.value.videoHeight,n.drawImage(t.value,0,0,e.value.width,e.value.height),n.getContextAttributes().willReadFrequently=!0;const s=n.getImageData(0,0,e.value.width,e.value.height),i=s.data;for(let e=0;e<i.length;e+=4){const t=i[e],a=i[e+1],n=i[e+2];Ue([t,a,n])&&(i[e+3]=0)}n.putImageData(s,0,0),requestAnimationFrame(o)}o()};function Ue(e){const[t,a,n]=e;return a>90&&t<90&&n<90}function et(e=[]){const t=(0,i.KR)(e),a=e=>{t.value=[...t.value,e]},n=()=>{const[e,...a]=t.value;return t.value=a,e},o=()=>{t.value=[]};return{add:a,remove:n,clear:o,first:(0,s.EW)((()=>t.value[0])),last:(0,s.EW)((()=>t.value[t.value.length-1])),size:(0,s.EW)((()=>t.value.length)),queue:t}}let tt=(0,i.KR)(),at=(0,i.KR)(!1);const{add:nt,remove:ot,first:st,size:it,queue:rt}=et(),lt=(0,i.KR)(!1);function ct(){const e=()=>"visible"!==document.visibilityState&&dt();return(0,s.sV)((()=>{window.addEventListener("visibilitychange",e)})),(0,s.xo)((()=>{window.removeEventListener("visibilitychange",e),tt.value&&(tt.value.ondataavailable=null)})),(0,s.wB)(tt,(e=>{e&&(e.ondataavailable=e=>{at.value&&nt(e.data)})})),ut(),{microphone:tt,microphoneIsOpen:at,startMicrophone:vt,stopMicrophone:dt,queue:rt,isRecording:lt,enqueueBlob:nt,removeBlob:ot,firstBlob:st,queueSize:it}}const ut=async()=>{const e=await navigator.mediaDevices.getUserMedia({audio:{noiseSuppression:!0,echoCancellation:!0}});tt.value=new MediaRecorder(e)},dt=()=>{if(tt.value&&"recording"===tt.value.state){lt.value=!1;const e=setTimeout((()=>{clearTimeout(e),tt.value.pause(),at.value=!1}),1500)}},vt=()=>{tt.value&&("paused"===tt.value.state?tt.value.resume():"recording"!==tt.value.state&&tt.value.start(250),at.value=!0,lt.value=!0)};var ht=a(4187),pt=a(3715),ft=a(683);const gt=async()=>"b609915a439eb06151cc4b3b91d91063b57b80df",Lt=(0,i.KR)(),wt=(0,i.KR)(!1),mt=(0,i.KR)(!1);let yt=(0,i.KR)({isFinal:!0,text:""});const xt=async e=>{Lt.value||wt.value||(wt.value=!0,Lt.value=new ht.o(await gt(),{},{language:e,model:"nova-2",interim_results:!0,smart_format:!0,endpointing:350,utterance_end_ms:1e3,filler_words:!0}),wt.value=!1)},bt=()=>{let e;Lt.value&&mt?e=setInterval((()=>{Lt.value&&Lt.value.getReadyState()!==pt.y.OPEN?clearInterval(e):Lt.value&&Lt.value.keepAlive()}),1e4):e&&clearInterval(e)},kt=()=>{Lt.value&&void 0!==Lt.value.getReadyState()&&(Lt.value.addListener(ft.Y.Open,(()=>{mt.value=!0})),Lt.value.addListener(ft.Y.Close,(()=>{Mt()})),Lt.value.addListener(ft.Y.Error,(()=>{Mt()})),Lt.value.addListener(ft.Y.Metadata,(e=>{console.log(e,"Metadata")})),Lt.value.addListener(ft.Y.Transcript,(e=>{e.channel.alternatives[0].transcript&&(yt.value={isFinal:e.is_final,text:e.channel.alternatives[0].transcript})})))},Mt=()=>{Lt.value&&(mt.value=!1,Lt.value.removeAllListeners(),Lt.value=void 0)};function Ht(e){const t=async()=>{await xt(e),kt()};return t(),(0,s.wB)(Lt,(()=>{bt()})),(0,s.xo)((()=>{Mt()})),{connection:Lt,isConnecting:wt,transcript:yt,connectionIsReady:mt}}const Ct=(0,i.KR)([]),Rt=(0,i.KR)(""),Vt=(0,i.KR)([]),Tt=(0,i.KR)(!1),Zt=(0,i.KR)(""),_t=(0,i.KR)("");function jt(){return{currentMessage:Zt,textArr:Ct,arrSize:(0,s.EW)((()=>Ct.value.length)),currentWord:_t,gtpIsStreaming:Tt,messages:Vt,clearMessages:()=>{Vt.value=[],Rt.value=""},sendMessage:Et}}const St=async()=>{const e="https://avatar.galimzhanov.com/apiv2/completions/";return await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Vt.value)}).then((e=>e.json()))},Et=async e=>{Vt.value.push({role:"user",content:e}),Tt.value=!0;const t=await St();Tt.value=!1,Zt.value=t,Vt.value.push({role:"assistant",content:t}),Kt()};function Kt(){Rt.value?fetch("https://rasult22.pockethost.io/api/collections/avatar_history/records/"+Rt.value,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:Vt.value.map((e=>`<p><b>${e.role}</b>: ${e.content}</p>`)).join("\n")})}):fetch("https://rasult22.pockethost.io/api/collections/avatar_history/records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:Vt.value.map((e=>`<p><b>${e.role}</b>: ${e.content}</p>`)).join("\n")})}).then((e=>e.json())).then((e=>{console.log(e),Rt.value=e.id}))}var Ot=a(8563);const It={class:"home min-h-[100vh] flex flex-col pt-[20vh] items-center bg-blue-900 py-4 px-4"},Pt=(0,s.Lk)("div",{class:"absolute inset-x-0 m-auto h-80 max-w-lg bg-gradient-to-tr from-indigo-400 via-teal-900 to-[#C084FC] blur-[118px]"},null,-1),Nt={class:"absolute top-4 flex w-full z-[2] flex-col items-center space-y-2"},At={class:"flex items-start sm:flex-wrap sm:justify-center"},Bt={key:0,class:"my-4 flex space-x-2 justify-center items-center"},Xt=(0,s.Lk)("div",{class:"h-2 w-2 bg-white rounded-full animate-bounce [animation-delay:-0.3s]"},null,-1),Ft=(0,s.Lk)("div",{class:"h-2 w-2 bg-white rounded-full animate-bounce [animation-delay:-0.15s]"},null,-1),zt=(0,s.Lk)("div",{class:"h-2 w-2 bg-white rounded-full animate-bounce"},null,-1),Wt=[Xt,Ft,zt],Yt={class:"flex items-center space-x-2"},Dt={key:0,initial:{opacity:0},enter:{opacity:1},delay:20,class:"text-white mx-auto sm:text-[14px] w-[50%] sm:w-full z-[2]"},qt=(0,s.Lk)("span",{class:"font-bold text-red-300"},"user:",-1),$t={key:1,initial:{opacity:0},enter:{opacity:1},delay:20,class:"text-white mx-auto mt-2 sm:text-[14px] w-[50%] sm:w-full z-[2] text-left"},Jt=(0,s.Lk)("span",{class:"font-bold text-purple-300"},"avatar:",-1),Gt="";var Qt=(0,s.pM)({__name:"AvatarView",setup(e){const t=(0,C.rd)();let a=(0,i.KR)(!1),n=(0,i.KR)(Gt),o=(0,i.KR)([]),r=(0,i.KR)(Gt),l=(0,i.KR)(Gt),c=localStorage.getItem("lang");const{showLoading:u,hideLoading:d}=w(),{sendMessage:v,messages:h,currentMessage:p,gtpIsStreaming:g,currentWord:L,clearMessages:m}=jt(),{connection:y,isConnecting:x,transcript:b,connectionIsReady:k}=Ht(c||"en"),{isRecording:M,microphoneIsOpen:R,queue:V,microphone:T,firstBlob:Z,removeBlob:_,queueSize:j,startMicrophone:S,stopMicrophone:E}=ct(),K=(0,i.KR)(),O=(0,i.KR)(),I=(0,i.KR)();(0,Ot.X2F)(I,(()=>{M.value&&G()}));const{isLoading:P,isGenerating:N,iceConnectionState:A,closeConnection:B,state:X,isError:F,errorMessage:z,generateVoice:W,start:Y}=Ae(K,O,c);(0,i.KR)("Салам Азамат, как дела?");const D=["Give me a second to gather my thoughts.","Hold on while I think this through.","Just a moment, I’m pondering.","Let me mull this over.","I need a quick minute to reflect.","Allow me some time to consider.","Bear with me as I contemplate.","I just need a brief moment to deliberate.","Hang tight, I’m processing.","Can you give me a short pause to think?"],q=["Секундочку, дайте мне подумать","Позвольте немного подумать.","Сейчас подумаем... Вот!","Аха, подождите немного","Давайте подумаем...","Позвольте мне взглянуть... Аха"];(0,s.wB)(p,(e=>{e&&(l.value=e)})),(0,s.sV)((async()=>{u(),await Y(),d()})),(0,s.xo)((()=>{B()})),(0,s.wB)([p,g],(([e])=>{if(e&&!g.value){if(console.log(e),e.length>2e3){const t=async()=>{const t=e.split(" "),a=Math.ceil(t.length/2);let n=t.slice(0,a);const o=Math.ceil(n.length/2);let s=n.slice(0,o).join(" "),i=n.slice(o).join("");console.log("sending firsthalffirst: "+n),await W(s),await new Promise((e=>{setTimeout((()=>{W(i).then((()=>{e(0)}))}),2e3)}));let r=t.slice(a);const l=Math.ceil(r.length/2);let c=r.slice(0,l).join(" "),u=r.slice(l).join(" ");await new Promise((e=>{setTimeout((()=>{W(c).then((()=>{e(0)}))}),2e3)})),await new Promise((e=>{setTimeout((()=>{W(u).then((()=>{e(0)}))}),2e3)}))};t()}if(e.length>200&&e.length<=2e3){console.log(`${e} is longer than 100`),console.log("split it to 2");const t=async()=>{const t=e.split(" "),a=Math.ceil(t.length/2);let n=t.slice(0,a).join(" ");console.log("sending first: "+n),await W(n);let o=t.slice(a).join(" ");setTimeout((()=>{console.log("sending second:"+o),W(o)}),2e3)};t()}else e.length<=200&&(console.log("sending:",e),W(e));l.value=e,p.value=""}}));const $=()=>{if(j.value>0&&!a.value){if(a.value=!0,k.value){const e=Z.value;e&&e.size>0&&y.value.send(e),_()}a.value=!1}};(0,s.wB)(j,(()=>{$()})),(0,s.wB)(b,(e=>{n.value=e.text,e.isFinal&&!g.value&&(r.value=e.text,o.value.push(e.text))}));const G=()=>{console.log("run"),setTimeout((()=>{if(E(),o.value.length){const e=o.value.join(" ");setTimeout((()=>{n.value=e}),400),console.log(e),v(e),o.value=[]}else!b.value.isFinal&&b.value.text&&(v(b.value.text),console.log("this case"));if("en"===c){const e=D[Math.floor(Math.random()*D.length)];W(e)}else{const e=q[Math.floor(Math.random()*q.length)];W(e)}}),1e3)};return(e,a)=>{const o=(0,s.gN)("touch"),r=(0,s.gN)("motion");return(0,s.uX)(),(0,s.CE)("div",It,[Pt,(0,s.Lk)("div",Nt,[(0,s.Lk)("div",{onClick:a[0]||(a[0]=e=>(0,i.R1)(t).push("/")),class:"absolute right-4 top-2"},["ru"===(0,i.R1)(c)?((0,s.uX)(),(0,s.Wv)(ue,{key:0})):((0,s.uX)(),(0,s.Wv)(ne,{key:1}))])]),(0,s.Lk)("div",{class:(0,H.C4)([{"opacity-0":"stopped"===(0,i.R1)(X)},"flex relative flex-col w-full items-center"])},[(0,s.Lk)("div",At,[(0,s.Lk)("video",{ref_key:"videoRef",ref:K,class:"my-4 hidden z-10 max-h-[400px] min-h-[300px] w-[300px]",autoPlay:"",playsInline:""},null,512),(0,s.Lk)("canvas",{ref_key:"canvasRef",ref:O,width:"300",height:"300",class:"z-10 my-4 max-h-[400px] h-[300px] flex w-[300px]"},null,512)]),(0,i.R1)(g)||(0,i.R1)(N)?((0,s.uX)(),(0,s.CE)("div",Bt,Wt)):(0,s.Q3)("",!0)],2),"connected"===(0,i.R1)(A)?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,H.C4)([{"opacity-0":"stopped"===(0,i.R1)(X)},"flex space-x-2 mt-4 sm:flex-wrap sm:justify-center"])},[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(J,{ref_key:"recButtonRef",ref:I,class:"z-[2] active:scale-105",onMousedown:(0,i.R1)(S),onMouseup:G,onTouchstart:(0,i.R1)(S),onTouchend:G},{default:(0,s.k6)((()=>[(0,s.Lk)("div",Yt,[(0,i.R1)(M)?((0,s.uX)(),(0,s.Wv)(He,{key:0})):((0,s.uX)(),(0,s.Wv)(we,{key:1})),(0,i.R1)(M)?((0,s.uX)(),(0,s.Wv)(f,{key:2})):(0,s.Q3)("",!0)])])),_:1},8,["onMousedown","onTouchstart"])),[[o,G,"longtap"]]),(0,s.bF)(J,{class:"z-[2] active:scale-105",onClick:a[1]||(a[1]=()=>{(0,i.R1)(m)(),(0,i.i9)(l)?l.value="":l="",(0,i.i9)(n)?n.value="":n=""})},{default:(0,s.k6)((()=>[(0,s.eW)((0,H.v_)("ru"===(0,i.R1)(c)?"Очистить чат":"Clear chat"),1)])),_:1})],2)):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,H.C4)([{"opacity-0":"stopped"===(0,i.R1)(X)},"w-full justify-center"])},[(0,i.R1)(n)?(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",Dt,[qt,(0,s.eW)(" "+(0,H.v_)((0,i.R1)(n)),1)])),[[r]]):(0,s.Q3)("",!0),(0,i.R1)(l)?(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",$t,[Jt,(0,s.eW)(" "+(0,H.v_)((0,i.R1)(l)),1)])),[[r]]):(0,s.Q3)("",!0)],2),(0,s.Q3)("",!0)])}}});const Ut=Qt;var ea=Ut;const ta=[{path:"/",name:"home",component:Y},{path:"/avatar",name:"avatar",component:ea},{path:"/about",name:"about",component:()=>a.e(594).then(a.bind(a,3478))}],aa=(0,C.aE)({history:(0,C.LA)("/"),routes:ta});var na=aa,oa=(0,s.pM)({__name:"App",setup(e){return(0,s.KC)((()=>{na.push("/")})),(e,t)=>{const a=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(a),(0,s.bF)(M),(0,s.bF)(O)],64)}}});const sa=oa;var ia=sa,ra=a(8090);const la=(0,o.Ef)(ia);la.use(na),la.use(n.uy),la.use(ra.A,{disableClick:!0,longTapTimeInterval:5e5}),la.mount("#app")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,n,o,s){if(!n){var i=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],s=e[u][2];for(var r=!0,l=0;l<n.length;l++)(!1&s||i>=s)&&Object.keys(a.O).every((function(e){return a.O[e](n[l])}))?n.splice(l--,1):(r=!1,s<i&&(i=s));if(r){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[n,o,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,n){return a.f[n](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/about.fb7f15c5.js"}}(),function(){a.miniCssF=function(e){}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="vue-avatar:";a.l=function(n,o,s,i){if(e[n])e[n].push(o);else{var r,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+s){r=d;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,a.nc&&r.setAttribute("nonce",a.nc),r.setAttribute("data-webpack",t+s),r.src=n),e[n]=[o];var v=function(t,a){r.onerror=r.onload=null,clearTimeout(h);var o=e[n];if(delete e[n],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach((function(e){return e(a)})),t)return t(a)},h=setTimeout(v.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=v.bind(null,r.onerror),r.onload=v.bind(null,r.onload),l&&document.head.appendChild(r)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){var e={524:0};a.f.j=function(t,n){var o=a.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var s=new Promise((function(a,n){o=e[t]=[a,n]}));n.push(o[2]=s);var i=a.p+a.u(t),r=new Error,l=function(n){if(a.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var s=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;r.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",r.name="ChunkLoadError",r.type=s,r.request=i,o[1](r)}};a.l(i,l,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,s,i=n[0],r=n[1],l=n[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(o in r)a.o(r,o)&&(a.m[o]=r[o]);if(l)var u=l(a)}for(t&&t(n);c<i.length;c++)s=i[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(u)},n=self["webpackChunkvue_avatar"]=self["webpackChunkvue_avatar"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[504],(function(){return a(3525)}));n=a.O(n)})();
//# sourceMappingURL=app.faf5b0e4.js.map